#!/usr/bin/env bash

# Switch between Ripgrep launcher mode (CTRL-R) and fzf filtering mode (CTRL-F)
# RG_PREFIX="fd -t f -H"
INITIAL_QUERY="${2:-}"
PWD="${1:-$(pwd)}"
RG_PREFIX="rg --files --hidden --glob '!.git/' $PWD"
IFS=: read -ra selected < <(
  FZF_DEFAULT_COMMAND="$RG_PREFIX $(printf %q "$INITIAL_QUERY")" \
  fzf --ansi \
      --preview 'bat --color=always {}' \
      --preview-window '50%,border-bottom,+{2}+3/3,~3' \
      --bind "shift-up:preview-page-up,shift-down:preview-page-down"
)
[ -n "${selected[0]}" ] && nvim "${selected[0]}"